<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculator - AVAV Yogic Traits</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Chart.js Library -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- jsPDF Library for PDF Download -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- D3.js Libraries -->
  <script src="https://d3js.org/d3.v6.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/d3-sankey@0.12.3/dist/d3-sankey.min.js"></script>
  <style>
    body {
      background-color: #f8f9fa;
      font-family: Arial, sans-serif;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none; /* Disabling text selection */
    }
    .container {
      max-width: 1100px;
      margin: auto;
    }
    .navbar {
      margin-bottom: 20px;
    }
    h2, h3 {
      text-align: center;
      color: #0d6efd;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 14px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
      vertical-align: middle;
    }
    th {
      background-color: #f4f4f4;
    }
    .options {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }
    .result,
    .insights {
      font-weight: bold;
      margin-top: 20px;
      padding: 10px;
      background: #e2e3e5;
      border: 1px solid #ccc;
    }
    button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      background-color: #0d6efd;
      color: #fff;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #0b5ed7;
    }
    input[type="text"] {
      width: 90%;
      padding: 4px;
      font-size: 13px;
    }
    .interpretation {
      font-size: 14px;
      padding: 8px;
      background: #fff;
      border: 1px solid #ccc;
      margin-top: 10px;
    }
    /* Visualization cards */
    .card {
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .card-body {
      padding: 20px;
    }
    /* Small yellow help icon */
    .help-icon {
      display: inline-block;
      width: 20px;
      height: 20px;
      line-height: 20px;
      text-align: center;
      border-radius: 50%;
      background-color: #ffc107;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      margin-left: 5px;
    }
  </style>
  <script>
    // Disable right-click and copy
    document.addEventListener("contextmenu", (event) => event.preventDefault());
    document.addEventListener("copy", (event) => event.preventDefault());
  </script>
</head>
<body>
  <!-- Navigation Bar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container">
      <a class="navbar-brand" href="index.html">AVAV Yogic Traits</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
          <li class="nav-item"><a class="nav-link active" href="calculator.html">Calculator</a></li>
          <li class="nav-item"><a class="nav-link" href="about.html">About</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container">
    <h2>AVAV Yogic Traits Calculator</h2>
    <p>Select a score (1-10) for each parameter and add remarks if needed:</p>

    <!-- Button to start the complete guide wizard -->
    <div class="text-center mb-3">
      <button type="button" class="btn btn-primary" onclick="startGuideWizard()">View Complete Guide</button>
    </div>

    <form id="avavForm">
      <table>
        <thead>
          <tr>
            <th>Category</th>
            <th>Parameter</th>
            <th>Criteria</th>
            <th>Score (1-10)</th>
            <th>Remarks/Comments</th>
          </tr>
        </thead>
        <tbody id="parametersTable">
          <!-- Rows dynamically generated -->
        </tbody>
      </table>
      <div class="d-flex flex-wrap gap-2">
        <button type="button" onclick="calculateScore()">Calculate Score</button>
        <button type="button" onclick="saveData()">Save Scores</button>
        <button type="button" onclick="loadData()">Load Scores</button>
        <button type="button" onclick="downloadCSV()">Download CSV Report</button>
        <button type="button" onclick="downloadPDF()">Download PDF</button>
        <button type="button" onclick="downloadGuideJSON()">Download Guide JSON</button>
        <button type="button" onclick="window.print()">Print Report</button>
      </div>
    </form>

    <div id="result" class="result"></div>
    <div id="insights" class="insights"></div>

    <!-- Visualization Section -->
    <h2 class="mt-5">Visualizations</h2>
    <div class="row">
      <!-- Bar Chart -->
      <div class="col-md-6">
        <div class="card mb-4">
          <div class="card-body text-center">
            <canvas id="barChart" width="400" height="300"></canvas>
            <div id="barChartInterpretation" class="interpretation"></div>
          </div>
        </div>
      </div>
      <!-- Radar Chart -->
      <div class="col-md-6">
        <div class="card mb-4">
          <div class="card-body text-center">
            <canvas id="radarChart" width="400" height="300"></canvas>
            <div id="radarChartInterpretation" class="interpretation"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <!-- Pie Chart -->
      <div class="col-md-6">
        <div class="card mb-4">
          <div class="card-body text-center">
            <canvas id="pieChart" width="400" height="300"></canvas>
            <div id="pieChartInterpretation" class="interpretation"></div>
          </div>
        </div>
      </div>
      <!-- Donut Chart -->
      <div class="col-md-6">
        <div class="card mb-4">
          <div class="card-body text-center">
            <canvas id="donutChart" width="400" height="300"></canvas>
            <div id="donutChartInterpretation" class="interpretation"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <!-- Line Chart -->
      <div class="col-md-6">
        <div class="card mb-4">
          <div class="card-body text-center">
            <canvas id="lineChart" width="400" height="300"></canvas>
            <div id="lineChartInterpretation" class="interpretation"></div>
          </div>
        </div>
      </div>
      <!-- Scatter Chart -->
      <div class="col-md-6">
        <div class="card mb-4">
          <div class="card-body text-center">
            <canvas id="scatterChart" width="400" height="300"></canvas>
            <div id="scatterChartInterpretation" class="interpretation"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Additional D3 Visualizations -->
    <h2 class="mt-5">Additional Visualizations</h2>
    <div class="row">
      <!-- Heatmap -->
      <div class="col-md-4">
        <div class="card mb-4">
          <div class="card-body text-center">
            <div id="heatmapContainer"></div>
            <div id="heatmapInterpretation" class="interpretation"></div>
          </div>
        </div>
      </div>
      <!-- Sankey Diagram -->
      <div class="col-md-4">
        <div class="card mb-4">
          <div class="card-body text-center">
            <div id="sankeyDiagram"></div>
            <div id="sankeyInterpretation" class="interpretation"></div>
          </div>
        </div>
      </div>
      <!-- Sunburst Chart -->
      <div class="col-md-4">
        <div class="card mb-4">
          <div class="card-body text-center">
            <div id="sunburstChart"></div>
            <div id="sunburstInterpretation" class="interpretation"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Personalized Insights Section -->
    <div id="personalizedInsights" class="insights mt-5"></div>

    <!-- Enhancements Section -->
    <div class="mt-5">
      <h3>Possible Enhancements</h3>
      <ul>
        <li><strong>Weightage System:</strong> Each parameter carries a weight reflecting its importance.</li>
        <li><strong>Dynamic Insights:</strong> The tool identifies low scoring clusters and recommends improvements.</li>
        <li><strong>Graphical Visualization:</strong> Multiple charts display strengths and weaknesses from different perspectives.</li>
        <li><strong>Deep Interpretation:</strong> Detailed analysis is provided for each category.</li>
        <li><strong>Export Options:</strong> Download your report as CSV or PDF, or print it directly.</li>
        <li><strong>Data Persistence:</strong> Save and reload your scores using localStorage.</li>
      </ul>
    </div>

    <!-- Classification Guide Section -->
    <div class="mt-5">
      <h3>Parameter Classification Guide (-10 Scale)</h3>
      <table>
        <thead>
          <tr>
            <th>Score</th>
            <th>Interpretation</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>1</td>
            <td>Extremely Poor</td>
            <td>Almost no awareness, effort, or engagement.</td>
          </tr>
          <tr>
            <td>2</td>
            <td>Very Poor</td>
            <td>Highly inconsistent, neglects practice.</td>
          </tr>
          <tr>
            <td>3</td>
            <td>Poor</td>
            <td>Occasionally follows good habits but struggles.</td>
          </tr>
          <tr>
            <td>4</td>
            <td>Below Average</td>
            <td>Inconsistent performance with some effort.</td>
          </tr>
          <tr>
            <td>5</td>
            <td>Average</td>
            <td>Basic understanding and effort.</td>
          </tr>
          <tr>
            <td>6</td>
            <td>Slightly Above Average</td>
            <td>Makes a moderate effort, improvements needed.</td>
          </tr>
          <tr>
            <td>7</td>
            <td>Good</td>
            <td>Regular practice with occasional lapses.</td>
          </tr>
          <tr>
            <td>8</td>
            <td>Very Good</td>
            <td>Strong consistency, well-aligned with yogic principles.</td>
          </tr>
          <tr>
            <td>9</td>
            <td>Excellent</td>
            <td>Almost perfect alignment and high awareness.</td>
          </tr>
          <tr>
            <td>10</td>
            <td>Ideal / Mastery</td>
            <td>Fully aligned and deeply practiced.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Modal for Guide Help / Wizard -->
  <div class="modal fade" id="guideModal" tabindex="-1" aria-labelledby="guideModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="guideModalLabel">Parameter Guide</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="resetWizard()"></button>
        </div>
        <div class="modal-body" id="guideModalBody">
          <!-- Guide text will be injected here -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" id="prevBtn" onclick="prevGuide()" disabled>Previous</button>
          <button type="button" class="btn btn-primary" id="nextBtn" onclick="nextGuide()">Next</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Script: Calculation, Visualization, Data Export, and Guide Wizard -->
  <script>
    // Global trend data and guide variables.
    let trendData = [];
    let wizardIndex = 0;

    // The 40 parameters with weights.
    const parameters = [
      {
        category: "Aahara (Diet & Nutrition)",
        name: "Meal Timing Consistency",
        criteria: "Regularity of meals in alignment with circadian rhythm",
        weight: 1.2,
      },
      {
        category: "Aahara (Diet & Nutrition)",
        name: "Food Variety",
        criteria: "Varied intake of nutrient-rich foods",
        weight: 1.0,
      },
      {
        category: "Aahara (Diet & Nutrition)",
        name: "Hydration & Water Intake",
        criteria: "Adequate daily water consumption",
        weight: 1.0,
      },
      {
        category: "Aahara (Diet & Nutrition)",
        name: "Portion Control",
        criteria: "Ability to avoid overeating or under-eating",
        weight: 1.0,
      },
      {
        category: "Aahara (Diet & Nutrition)",
        name: "Cooking Methods",
        criteria: "Preference for natural, unprocessed techniques",
        weight: 1.0,
      },
      {
        category: "Aahara (Diet & Nutrition)",
        name: "Mindful Eating Practices",
        criteria: "Conscious eating with gratitude",
        weight: 1.0,
      },
      {
        category: "Aahara (Diet & Nutrition)",
        name: "Refined Sugar & Processed Food Intake",
        criteria: "Minimizing refined sugars and processed foods",
        weight: 1.0,
      },
      {
        category: "Aahara (Diet & Nutrition)",
        name: "Meal Composition (Macronutrient Balance)",
        criteria: "Balanced proportions of proteins, carbs, and fats",
        weight: 1.2,
      },
      {
        category: "Aahara (Diet & Nutrition)",
        name: "Seasonal & Local Food Preference",
        criteria: "Preference for fresh, regional produce",
        weight: 1.0,
      },
      {
        category: "Aahara (Diet & Nutrition)",
        name: "Ayurvedic/Yogic Dietary Alignment",
        criteria: "Adherence to Sattvic, Rajasic, or Tamasic diet",
        weight: 1.5,
      },
      {
        category: "Vihara (Lifestyle & Daily Routine)",
        name: "Sleep Quality & Duration",
        criteria: "Consistent, restorative sleep",
        weight: 1.5,
      },
      {
        category: "Vihara (Lifestyle & Daily Routine)",
        name: "Physical Activity & Movement",
        criteria: "Regular exercise (Yoga, Walking, etc.)",
        weight: 1.3,
      },
      {
        category: "Vihara (Lifestyle & Daily Routine)",
        name: "Stress Management Techniques",
        criteria: "Use of meditation, pranayama, etc.",
        weight: 1.4,
      },
      {
        category: "Vihara (Lifestyle & Daily Routine)",
        name: "Work-Life Balance",
        criteria: "Balanced approach between work and rest",
        weight: 1.0,
      },
      {
        category: "Vihara (Lifestyle & Daily Routine)",
        name: "Leisure & Recreation",
        criteria: "Engagement in hobbies, music, travel, etc.",
        weight: 1.0,
      },
      {
        category: "Vihara (Lifestyle & Daily Routine)",
        name: "Exposure to Nature",
        criteria: "Regular contact with natural elements",
        weight: 1.0,
      },
      {
        category: "Vihara (Lifestyle & Daily Routine)",
        name: "Technology Usage & Digital Detox",
        criteria: "Balanced screen time and digital breaks",
        weight: 1.0,
      },
      {
        category: "Vihara (Lifestyle & Daily Routine)",
        name: "Community & Social Connections",
        criteria: "Quality interactions with family, friends",
        weight: 1.2,
      },
      {
        category: "Vihara (Lifestyle & Daily Routine)",
        name: "Routine & Rituals",
        criteria: "Consistency in daily habits and rituals",
        weight: 1.0,
      },
      {
        category: "Vihara (Lifestyle & Daily Routine)",
        name: "Exploration & Learning",
        criteria: "Curiosity and willingness to learn new things",
        weight: 1.0,
      },
      {
        category: "Achara (Conduct, Behavior, and Ethics)",
        name: "Self-Discipline & Punctuality",
        criteria: "Maintaining schedules and commitments",
        weight: 1.5,
      },
      {
        category: "Achara (Conduct, Behavior, and Ethics)",
        name: "Compassion & Kindness",
        criteria: "Exhibiting empathy and care towards others",
        weight: 1.2,
      },
      {
        category: "Achara (Conduct, Behavior, and Ethics)",
        name: "Honesty & Integrity",
        criteria: "Truthfulness and ethical behavior",
        weight: 1.2,
      },
      {
        category: "Achara (Conduct, Behavior, and Ethics)",
        name: "Conflict Resolution & Communication",
        criteria: "Effective and peaceful communication",
        weight: 1.0,
      },
      {
        category: "Achara (Conduct, Behavior, and Ethics)",
        name: "Spiritual & Ethical Practices",
        criteria: "Engagement in prayer, rituals, and seva",
        weight: 1.0,
      },
      {
        category: "Achara (Conduct, Behavior, and Ethics)",
        name: "Community Service & Volunteering",
        criteria: "Participation in acts of service",
        weight: 1.0,
      },
      {
        category: "Achara (Conduct, Behavior, and Ethics)",
        name: "Minimalism & Detachment",
        criteria: "Avoidance of material excess",
        weight: 1.0,
      },
      {
        category: "Achara (Conduct, Behavior, and Ethics)",
        name: "Respect for Elders, Teachers & Nature",
        criteria: "Honoring wisdom and traditions",
        weight: 1.2,
      },
      {
        category: "Achara (Conduct, Behavior, and Ethics)",
        name: "Personal Boundaries & Energy Management",
        criteria: "Maintaining personal space and energy",
        weight: 1.0,
      },
      {
        category: "Achara (Conduct, Behavior, and Ethics)",
        name: "Leadership & Influence",
        criteria: "Inspiring others positively",
        weight: 1.3,
      },
      {
        category: "Vichara (Thought Process & Mental Discipline)",
        name: "Decision-Making Clarity",
        criteria: "Making clear, informed decisions",
        weight: 1.0,
      },
      {
        category: "Vichara (Thought Process & Mental Discipline)",
        name: "Mindfulness & Self-Awareness",
        criteria: "Being present and introspective",
        weight: 1.5,
      },
      {
        category: "Vichara (Thought Process & Mental Discipline)",
        name: "Emotional Intelligence & Control",
        criteria: "Managing emotions effectively",
        weight: 1.5,
      },
      {
        category: "Vichara (Thought Process & Mental Discipline)",
        name: "Intellectual Curiosity & Learning",
        criteria: "Eagerness to learn and grow",
        weight: 1.0,
      },
      {
        category: "Vichara (Thought Process & Mental Discipline)",
        name: "Resilience & Ability to Handle Failures",
        criteria: "Bouncing back from setbacks",
        weight: 1.2,
      },
      {
        category: "Vichara (Thought Process & Mental Discipline)",
        name: "Perspective-Taking & Empathy",
        criteria: "Understanding diverse viewpoints",
        weight: 1.2,
      },
      {
        category: "Vichara (Thought Process & Mental Discipline)",
        name: "Creativity & Innovation",
        criteria: "Thinking outside the box",
        weight: 1.0,
      },
      {
        category: "Vichara (Thought Process & Mental Discipline)",
        name: "Skepticism vs. Open-Mindedness",
        criteria: "Balancing critical thinking and openness",
        weight: 1.0,
      },
      {
        category: "Vichara (Thought Process & Mental Discipline)",
        name: "Goal-Setting & Vision Clarity",
        criteria: "Having clear, achievable goals",
        weight: 1.0,
      },
      {
        category: "Vichara (Thought Process & Mental Discipline)",
        name: "Optimism & Pessimism Balance",
        criteria: "Maintaining a positive yet realistic outlook",
        weight: 1.0,
      },
    ];

    // Instead of loading guide data via CSV, we now have it directly in JSON format.
    const guideData = [
      {
        "Category": "Aahara (Diet & Nutrition)",
        "Parameter": "Meal Timing Consistency",
        "Guide": "Maintain a consistent meal schedule by eating breakfast, lunch, and dinner at regular intervals. This routine helps synchronize your body’s circadian rhythm, improves digestion, stabilizes blood sugar, and provides sustained energy throughout the day. Consider setting fixed meal times, preparing meals in advance, and avoiding late-night snacking."
      },
      {
        "Category": "Aahara (Diet & Nutrition)",
        "Parameter": "Food Variety",
        "Guide": "Incorporate a wide range of foods from different food groups to ensure your diet is nutrient-dense and balanced. A varied diet provides essential vitamins, minerals, and antioxidants needed for overall health. Experiment with new fruits, vegetables, grains, and protein sources to keep your meals interesting and nutritionally complete."
      },
      {
        "Category": "Aahara (Diet & Nutrition)",
        "Parameter": "Hydration & Water Intake",
        "Guide": "Aim to drink at least 8 glasses of water daily, adjusting based on activity levels and climate. Adequate hydration supports digestion, detoxification, and nutrient absorption. Carry a water bottle and set reminders to drink water throughout the day to maintain optimal hydration."
      },
      {
        "Category": "Aahara (Diet & Nutrition)",
        "Parameter": "Portion Control",
        "Guide": "Practice portion control by using smaller plates or measuring your servings. This helps prevent overeating and aids in maintaining energy balance. Be mindful of hunger and fullness cues, and avoid distractions during meals to better gauge appropriate portions."
      },
      {
        "Category": "Aahara (Diet & Nutrition)",
        "Parameter": "Cooking Methods",
        "Guide": "Opt for healthy cooking methods such as steaming, boiling, baking, or grilling instead of frying. These methods help preserve nutrients and reduce excess fats and calories. Experiment with herbs and spices to add flavor without unhealthy additives."
      },
      {
        "Category": "Aahara (Diet & Nutrition)",
        "Parameter": "Mindful Eating Practices",
        "Guide": "Adopt mindful eating by focusing on the sensory experience of your food—its taste, texture, and aroma. Eat slowly, savor each bite, and avoid distractions during meals. This practice can improve digestion, prevent overeating, and foster a deeper appreciation for your meals."
      },
      {
        "Category": "Aahara (Diet & Nutrition)",
        "Parameter": "Refined Sugar & Processed Food Intake",
        "Guide": "Limit your consumption of refined sugars and processed foods, which can cause energy spikes, crashes, and long-term health issues. Read food labels carefully and choose whole, natural foods to help maintain steady energy and reduce inflammation."
      },
      {
        "Category": "Aahara (Diet & Nutrition)",
        "Parameter": "Meal Composition (Macronutrient Balance)",
        "Guide": "Aim for balanced meals that include a mix of proteins, carbohydrates, and healthy fats. This balance supports sustained energy, muscle repair, and overall cognitive function. Use a balanced plate model: half fruits and vegetables, one quarter lean protein, and one quarter whole grains."
      },
      {
        "Category": "Aahara (Diet & Nutrition)",
        "Parameter": "Seasonal & Local Food Preference",
        "Guide": "Choose seasonal and locally sourced foods for maximum freshness and nutritional value. Seasonal produce often contains higher levels of vitamins and minerals and supports local economies. Adjust your meal plans according to seasonal availability for the best results."
      },
      {
        "Category": "Aahara (Diet & Nutrition)",
        "Parameter": "Ayurvedic/Yogic Dietary Alignment",
        "Guide": "Align your diet with Ayurvedic or yogic principles by choosing foods that balance your body’s doshas. Emphasize fresh, whole, and lightly cooked foods that promote clarity and calmness. Experiment with sattvic (pure) food choices to support both physical and mental harmony."
      },
      {
        "Category": "Vihara (Lifestyle & Daily Routine)",
        "Parameter": "Sleep Quality & Duration",
        "Guide": "Prioritize quality sleep by creating a consistent bedtime routine and a sleep-friendly environment. Aim for 7-9 hours per night to support physical recovery, cognitive function, and emotional balance. Reduce screen time before bed and consider relaxation techniques to improve sleep quality."
      },
      {
        "Category": "Vihara (Lifestyle & Daily Routine)",
        "Parameter": "Physical Activity & Movement",
        "Guide": "Incorporate regular physical activity—such as yoga, walking, or other forms of exercise—into your routine. Regular movement boosts cardiovascular health, enhances flexibility, and improves mental clarity. Mix different types of exercise to cover strength, endurance, and flexibility."
      },
      {
        "Category": "Vihara (Lifestyle & Daily Routine)",
        "Parameter": "Stress Management Techniques",
        "Guide": "Adopt stress management practices like meditation, deep breathing, or mindfulness exercises to lower stress levels and improve overall clarity. Regular practice can help you manage daily pressures and maintain emotional balance. Consider scheduling dedicated stress-relief sessions each day."
      },
      {
        "Category": "Vihara (Lifestyle & Daily Routine)",
        "Parameter": "Work-Life Balance",
        "Guide": "Strive to balance your professional obligations with personal time. Set clear boundaries between work and leisure, schedule breaks, and ensure you have time for activities that relax and recharge you. Effective time management is key to preventing burnout."
      },
      {
        "Category": "Vihara (Lifestyle & Daily Routine)",
        "Parameter": "Leisure & Recreation",
        "Guide": "Engage in hobbies and recreational activities that bring you joy and relaxation. Taking time for leisure can reduce stress, spark creativity, and improve overall well-being. Plan regular breaks and fun activities to maintain a healthy work-life balance."
      },
      {
        "Category": "Vihara (Lifestyle & Daily Routine)",
        "Parameter": "Exposure to Nature",
        "Guide": "Spend time outdoors to benefit from fresh air, natural light, and the calming influence of nature. Regular exposure can lower stress levels, boost mood, and enhance physical health. Consider activities like walking in a park, hiking, or gardening."
      },
      {
        "Category": "Vihara (Lifestyle & Daily Routine)",
        "Parameter": "Technology Usage & Digital Detox",
        "Guide": "Limit excessive screen time by setting aside specific periods for digital detox. Regular breaks from devices can reduce eye strain, improve mental focus, and promote overall well-being. Establish technology-free zones or times during your day."
      },
      {
        "Category": "Vihara (Lifestyle & Daily Routine)",
        "Parameter": "Community & Social Connections",
        "Guide": "Invest in nurturing strong relationships with family, friends, and community members. Positive social interactions provide emotional support, reduce stress, and contribute to a sense of belonging. Make time for social activities and meaningful conversations."
      },
      {
        "Category": "Vihara (Lifestyle & Daily Routine)",
        "Parameter": "Routine & Rituals",
        "Guide": "Establish daily routines and personal rituals that provide structure and stability. Consistent habits such as morning meditation or evening reflection can ground you and create a sense of order in your life. Routines also help conserve mental energy."
      },
      {
        "Category": "Vihara (Lifestyle & Daily Routine)",
        "Parameter": "Exploration & Learning",
        "Guide": "Maintain a curious and open mindset by exploring new ideas, skills, and experiences. Lifelong learning fuels personal growth and keeps your mind active. Read, attend workshops, or engage in creative hobbies to continuously expand your horizons."
      },
      {
        "Category": "Achara (Conduct, Behavior, and Ethics)",
        "Parameter": "Self-Discipline & Punctuality",
        "Guide": "Cultivate self-discipline by setting clear goals and adhering to a structured schedule. Being punctual and reliable builds trust and sets a positive example in both personal and professional contexts. Use planners or digital reminders to stay on track."
      },
      {
        "Category": "Achara (Conduct, Behavior, and Ethics)",
        "Parameter": "Compassion & Kindness",
        "Guide": "Practice empathy and kindness in your daily interactions. Small acts of kindness can foster stronger relationships, enhance emotional well-being, and create a positive ripple effect in your community. Reflect regularly on ways to help and support others."
      },
      {
        "Category": "Achara (Conduct, Behavior, and Ethics)",
        "Parameter": "Honesty & Integrity",
        "Guide": "Maintain honesty and transparency in all your dealings. Upholding integrity builds trust and strengthens your reputation. In both simple and challenging situations, choose truthfulness as a guiding principle for ethical behavior."
      },
      {
        "Category": "Achara (Conduct, Behavior, and Ethics)",
        "Parameter": "Conflict Resolution & Communication",
        "Guide": "Develop effective communication and conflict-resolution skills to handle disagreements peacefully. Practice active listening, express your thoughts clearly, and seek mutually beneficial solutions. These skills help maintain harmony in relationships."
      },
      {
        "Category": "Achara (Conduct, Behavior, and Ethics)",
        "Parameter": "Spiritual & Ethical Practices",
        "Guide": "Engage in spiritual or ethical practices that resonate with you, such as meditation, prayer, or acts of service. These practices can provide inner strength, moral guidance, and a sense of purpose, contributing to overall personal well-being."
      },
      {
        "Category": "Achara (Conduct, Behavior, and Ethics)",
        "Parameter": "Community Service & Volunteering",
        "Guide": "Participate regularly in community service or volunteer work. Giving back to your community not only enriches your own life but also builds empathy and strengthens social bonds. Choose causes that align with your values and commit time to them."
      },
      {
        "Category": "Achara (Conduct, Behavior, and Ethics)",
        "Parameter": "Minimalism & Detachment",
        "Guide": "Adopt a minimalist approach by reducing clutter and focusing on what truly matters. Embracing detachment from material excess can lead to greater mental clarity, reduced stress, and a more purposeful life. Regularly assess and simplify your possessions."
      },
      {
        "Category": "Achara (Conduct, Behavior, and Ethics)",
        "Parameter": "Respect for Elders, Teachers & Nature",
        "Guide": "Show deep respect for those who have imparted wisdom and for the natural world. Honoring elders, mentors, and nature fosters humility, gratitude, and a sense of connectedness. Engage in traditions and practices that celebrate these values."
      },
      {
        "Category": "Achara (Conduct, Behavior, and Ethics)",
        "Parameter": "Personal Boundaries & Energy Management",
        "Guide": "Set and maintain clear personal boundaries to protect your energy and well-being. Learn to say no when necessary, and prioritize self-care. Healthy boundaries enable you to engage more fully in relationships without feeling drained."
      },
      {
        "Category": "Achara (Conduct, Behavior, and Ethics)",
        "Parameter": "Leadership & Influence",
        "Guide": "Develop leadership skills by inspiring others with integrity, empathy, and vision. Effective leadership involves clear communication, accountability, and a commitment to uplifting those around you. Seek opportunities to mentor and lead by example."
      },
      {
        "Category": "Vichara (Thought Process & Mental Discipline)",
        "Parameter": "Decision-Making Clarity",
        "Guide": "Improve your decision-making by gathering all relevant information, considering various perspectives, and reflecting deeply before acting. A clear and structured decision-making process minimizes regret and leads to better outcomes."
      },
      {
        "Category": "Vichara (Thought Process & Mental Discipline)",
        "Parameter": "Mindfulness & Self-Awareness",
        "Guide": "Practice mindfulness to enhance self-awareness and stay present in the moment. Regular mindfulness exercises can help you observe your thoughts and emotions without judgment, leading to improved focus and inner calm."
      },
      {
        "Category": "Vichara (Thought Process & Mental Discipline)",
        "Parameter": "Emotional Intelligence & Control",
        "Guide": "Develop emotional intelligence by learning to recognize, understand, and regulate your emotions. Techniques such as deep breathing, journaling, or therapy can help maintain emotional balance and improve your interactions."
      },
      {
        "Category": "Vichara (Thought Process & Mental Discipline)",
        "Parameter": "Intellectual Curiosity & Learning",
        "Guide": "Foster a passion for learning by continuously exploring new ideas and challenges. Intellectual curiosity not only expands your knowledge but also fuels creativity and innovation. Engage in reading, courses, and thoughtful discussions."
      },
      {
        "Category": "Vichara (Thought Process & Mental Discipline)",
        "Parameter": "Resilience & Ability to Handle Failures",
        "Guide": "Build resilience by viewing setbacks as valuable learning opportunities. Cultivate persistence by setting realistic goals, seeking feedback, and maintaining a positive outlook even in the face of failure."
      },
      {
        "Category": "Vichara (Thought Process & Mental Discipline)",
        "Parameter": "Perspective-Taking & Empathy",
        "Guide": "Enhance your ability to understand others by actively practicing perspective-taking. Empathy not only improves your relationships but also helps in resolving conflicts. Try to see situations from multiple viewpoints and reflect on different opinions."
      },
      {
        "Category": "Vichara (Thought Process & Mental Discipline)",
        "Parameter": "Creativity & Innovation",
        "Guide": "Encourage creativity by stepping outside your comfort zone and challenging conventional ideas. Experiment with new approaches and embrace a mindset of innovation. Engage in brainstorming sessions, creative hobbies, or problem-solving activities that stimulate fresh thinking."
      },
      {
        "Category": "Vichara (Thought Process & Mental Discipline)",
        "Parameter": "Skepticism vs. Open-Mindedness",
        "Guide": "Strike a healthy balance between skepticism and open-mindedness. While it’s important to question assumptions and seek evidence, remaining open to new ideas fosters growth and understanding. Use critical thinking to evaluate information objectively."
      },
      {
        "Category": "Vichara (Thought Process & Mental Discipline)",
        "Parameter": "Goal-Setting & Vision Clarity",
        "Guide": "Set clear, specific, and achievable goals that align with your long-term vision. Break down your objectives into actionable steps and regularly review your progress. A well-defined vision provides direction and motivates consistent effort."
      },
      {
        "Category": "Vichara (Thought Process & Mental Discipline)",
        "Parameter": "Optimism & Pessimism Balance",
        "Guide": "Maintain a balanced outlook by blending optimism with a realistic appraisal of challenges. A positive attitude motivates action, while a cautious perspective prepares you for potential obstacles. Practice gratitude and planning simultaneously for the best outcomes."
      }
    ];

    // Build parameter table rows with help icons.
    const tableBody = document.getElementById("parametersTable");
    parameters.forEach((param, index) => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${param.category}</td>
        <td>
          ${param.name}
          <span class="help-icon" onclick="showGuide(${index})">?</span>
        </td>
        <td>${param.criteria}</td>
        <td class="options">
          ${[...Array(10)].map((_, i) => `<label><input type="radio" name="param${index}" value="${i+1}"> ${i+1}</label>`).join(" ")}
        </td>
        <td><input type="text" name="remark${index}" placeholder="Comments"></td>
      `;
      tableBody.appendChild(row);
    });

    // Classification function.
    function classify(avg) {
      if (avg >= 7.5) return '<span class="text-success">Sattva</span>';
      else if (avg >= 5) return '<span class="text-warning">Rajas</span>';
      else return '<span class="text-danger">Tamas</span>';
    }

    // Main calculation function.
    function calculateScore() {
      let totalWeighted = 0, totalWeight = 0;
      const categoryWeighted = {
        "Aahara (Diet & Nutrition)": 0,
        "Vihara (Lifestyle & Daily Routine)": 0,
        "Achara (Conduct, Behavior, and Ethics)": 0,
        "Vichara (Thought Process & Mental Discipline)": 0
      };
      let scatterData = [];
      parameters.forEach((param, index) => {
        const radios = document.getElementsByName("param" + index);
        let selectedScore = 0;
        radios.forEach(radio => {
          if (radio.checked) selectedScore = parseInt(radio.value);
        });
        scatterData.push({ x: index + 1, y: selectedScore });
        const weightedScore = selectedScore * param.weight;
        totalWeighted += weightedScore;
        totalWeight += (10 * param.weight);
        categoryWeighted[param.category] += weightedScore;
      });
      const overallAvg = (totalWeighted / totalWeight) * 10;
      let resultText = `<h3>Results</h3>
        <p><strong>Total Weighted Score:</strong> ${totalWeighted.toFixed(2)} / ${totalWeight.toFixed(2)}</p>
        <p><strong>Overall Classification:</strong> ${classify(overallAvg)} (Weighted Average: ${overallAvg.toFixed(2)})</p>`;
      
      let lowestCat = "", lowestAvg = 11, categoryAverages = {};
      Object.keys(categoryWeighted).forEach(cat => {
        const catTotalWeight = parameters.filter(p => p.category === cat)
          .reduce((sum, p) => sum + p.weight, 0) * 10;
        const avg = (categoryWeighted[cat] / catTotalWeight) * 10;
        categoryAverages[cat] = avg;
        resultText += `<p><strong>${cat}:</strong> ${classify(avg)} (Weighted Average: ${avg.toFixed(2)})</p>`;
        if (avg < lowestAvg) {
          lowestAvg = avg;
          lowestCat = cat;
        }
      });
      document.getElementById("result").innerHTML = resultText;
      const insightsText = `<h3>Dynamic Insights & Recommendations</h3>
        <p>Your lowest scoring category is <strong>${lowestCat}</strong> (Weighted Average: ${lowestAvg.toFixed(2)}). Focus on this area for improvement.</p>`;
      document.getElementById("insights").innerHTML = insightsText;
      trendData.push({ time: new Date().toLocaleTimeString(), score: overallAvg });
      // Generate all charts and interpretations.
      generateBarChart(categoryAverages);
      generateRadarChart(categoryAverages);
      generatePieChart(categoryAverages);
      generateDonutChart();
      generateLineChart(trendData);
      generateScatterChart(scatterData);
      generateHeatmap();
      generateSankeyDiagram();
      generateSunburstChart();
      generateChartInterpretations(categoryAverages, trendData, scatterData);
      generatePersonalizedInsights();
    }

    // ----------------- Chart.js Visualization Functions ----------------- //
    function generateBarChart(categoryAverages) {
      const ctx = document.getElementById("barChart").getContext("2d");
      const labels = Object.keys(categoryAverages);
      const data = labels.map(cat => categoryAverages[cat]);
      if (window.barChartInstance) window.barChartInstance.destroy();
      window.barChartInstance = new Chart(ctx, {
        type: "bar",
        data: {
          labels: labels,
          datasets: [{
            label: "Weighted Average Score",
            data: data,
            backgroundColor: ["#28a745", "#ffc107", "#17a2b8", "#dc3545"]
          }]
        },
        options: { scales: { y: { beginAtZero: true, max: 10 } } }
      });
    }

    function generateRadarChart(categoryAverages) {
      const ctx = document.getElementById("radarChart").getContext("2d");
      const labels = Object.keys(categoryAverages);
      const data = labels.map(cat => categoryAverages[cat]);
      if (window.radarChartInstance) window.radarChartInstance.destroy();
      window.radarChartInstance = new Chart(ctx, {
        type: "radar",
        data: {
          labels: labels,
          datasets: [{
            label: "Weighted Average Score",
            data: data,
            backgroundColor: "rgba(13,110,253,0.2)",
            borderColor: "#0d6efd",
            pointBackgroundColor: "#0d6efd"
          }]
        },
        options: { scales: { r: { beginAtZero: true, max: 10 } } }
      });
    }

    function generatePieChart(categoryAverages) {
      const ctx = document.getElementById("pieChart").getContext("2d");
      const labels = Object.keys(categoryAverages);
      const data = labels.map(cat => categoryAverages[cat]);
      if (window.pieChartInstance) window.pieChartInstance.destroy();
      window.pieChartInstance = new Chart(ctx, {
        type: "pie",
        data: {
          labels: labels,
          datasets: [{
            label: "Category Distribution (%)",
            data: data,
            backgroundColor: ["#28a745", "#ffc107", "#17a2b8", "#dc3545"]
          }]
        },
        options: {
          plugins: {
            tooltip: {
              callbacks: {
                label: function(context) {
                  const sum = data.reduce((a, b) => a + b, 0);
                  const percentage = ((context.parsed / sum) * 100).toFixed(2) + "%";
                  return context.label + ": " + percentage;
                }
              }
            }
          }
        }
      });
    }

    function generateDonutChart() {
      const ctx = document.getElementById("donutChart").getContext("2d");
      const classificationCount = { Sattva: 1, Rajas: 1, Tamas: 2 };
      const labels = Object.keys(classificationCount);
      const data = labels.map(label => classificationCount[label]);
      if (window.donutChartInstance) window.donutChartInstance.destroy();
      window.donutChartInstance = new Chart(ctx, {
        type: "doughnut",
        data: {
          labels: labels,
          datasets: [{
            label: "Classification Distribution",
            data: data,
            backgroundColor: ["#28a745", "#ffc107", "#dc3545"]
          }]
        }
      });
    }

    function generateLineChart(trendData) {
      const ctx = document.getElementById("lineChart").getContext("2d");
      const labels = trendData.map(entry => entry.time);
      const data = trendData.map(entry => entry.score);
      if (window.lineChartInstance) window.lineChartInstance.destroy();
      window.lineChartInstance = new Chart(ctx, {
        type: "line",
        data: {
          labels: labels,
          datasets: [{
            label: "Overall Score Over Time",
            data: data,
            fill: false,
            borderColor: "#0d6efd",
            tension: 0.1
          }]
        },
        options: { scales: { y: { beginAtZero: true, max: 10 } } }
      });
    }

    function generateScatterChart(scatterData) {
      const ctx = document.getElementById("scatterChart").getContext("2d");
      if (window.scatterChartInstance) window.scatterChartInstance.destroy();
      window.scatterChartInstance = new Chart(ctx, {
        type: "scatter",
        data: {
          datasets: [{
            label: "Parameter Scores",
            data: scatterData,
            backgroundColor: "#0d6efd"
          }]
        },
        options: {
          scales: {
            x: { title: { display: true, text: "Parameter Index" } },
            y: { title: { display: true, text: "Score" }, beginAtZero: true, max: 10 }
          }
        }
      });
    }

    // ----------------- D3 Visualizations ----------------- //
    function generateHeatmap() {
      let html = `<h5>Heatmap of Parameter Scores</h5><table class="table table-bordered text-center"><thead><tr><th>Parameter</th><th>Score</th></tr></thead><tbody>`;
      parameters.forEach((param, index) => {
        const radios = document.getElementsByName("param" + index);
        let score = 0;
        radios.forEach(radio => {
          if (radio.checked) score = parseInt(radio.value);
        });
        const color = score >= 7.5 ? "#28a745" : score >= 5 ? "#ffc107" : "#dc3545";
        html += `<tr><td>${param.name}</td><td style="background-color:${color}; color:#fff;">${score}</td></tr>`;
      });
      html += `</tbody></table>`;
      document.getElementById("heatmapContainer").innerHTML = html;
      document.getElementById("heatmapInterpretation").innerHTML = "<p>The heatmap highlights your parameter scores with color intensity. Red indicates areas needing the most attention.</p>";
    }

    function generateSankeyDiagram() {
      document.getElementById("sankeyDiagram").innerHTML = "";
      const data = {
        nodes: [
          { name: "Aahara" },
          { name: "Vihara" },
          { name: "Achara" },
          { name: "Vichara" },
          { name: "Sattva" },
          { name: "Rajas" },
          { name: "Tamas" }
        ],
        links: [
          { source: 0, target: 4, value: 5 },
          { source: 0, target: 5, value: 3 },
          { source: 1, target: 4, value: 6 },
          { source: 1, target: 6, value: 4 },
          { source: 2, target: 5, value: 7 },
          { source: 2, target: 6, value: 2 },
          { source: 3, target: 4, value: 4 },
          { source: 3, target: 5, value: 5 }
        ]
      };
      const width = 400, height = 300;
      const svg = d3.select("#sankeyDiagram").append("svg")
                    .attr("width", width)
                    .attr("height", height);
      const sankey = d3.sankey()
                       .nodeWidth(15)
                       .nodePadding(10)
                       .extent([[1, 1], [width - 1, height - 6]]);
      const { nodes, links } = sankey({
        nodes: data.nodes.map(d => Object.assign({}, d)),
        links: data.links.map(d => Object.assign({}, d))
      });
      svg.append("g")
         .selectAll("rect")
         .data(nodes)
         .enter()
         .append("rect")
         .attr("x", d => d.x0)
         .attr("y", d => d.y0)
         .attr("height", d => d.y1 - d.y0)
         .attr("width", d => d.x1 - d.x0)
         .attr("fill", "#0d6efd")
         .attr("stroke", "#000");
      svg.append("g")
         .selectAll("path")
         .data(links)
         .enter()
         .append("path")
         .attr("d", d3.sankeyLinkHorizontal())
         .attr("stroke", "#ffc107")
         .attr("stroke-width", d => Math.max(1, d.width))
         .attr("fill", "none");
      svg.append("g")
         .selectAll("text")
         .data(nodes)
         .enter()
         .append("text")
         .attr("x", d => d.x0 - 6)
         .attr("y", d => (d.y1 + d.y0) / 2)
         .attr("dy", "0.35em")
         .attr("text-anchor", "end")
         .text(d => d.name);
      document.getElementById("sankeyInterpretation").innerHTML = "<p>The Sankey diagram visualizes the flow between your AVAV categories and their influence on your overall well-being.</p>";
    }

    function generateSunburstChart() {
      document.getElementById("sunburstChart").innerHTML = "";
      const data = {
        name: "AVAV",
        children: [
          { name: "Aahara", children: parameters.filter(p => p.category === "Aahara (Diet & Nutrition)").map(p => ({ name: p.name, value: 1 })) },
          { name: "Vihara", children: parameters.filter(p => p.category === "Vihara (Lifestyle & Daily Routine)").map(p => ({ name: p.name, value: 1 })) },
          { name: "Achara", children: parameters.filter(p => p.category === "Achara (Conduct, Behavior, and Ethics)").map(p => ({ name: p.name, value: 1 })) },
          { name: "Vichara", children: parameters.filter(p => p.category === "Vichara (Thought Process & Mental Discipline)").map(p => ({ name: p.name, value: 1 })) }
        ]
      };
      const width = 400, radius = width / 2;
      const partition = d3.partition().size([2 * Math.PI, radius]);
      const root = d3.hierarchy(data).sum(d => d.value);
      partition(root);
      const svg = d3.select("#sunburstChart").append("svg")
                    .attr("width", width)
                    .attr("height", width)
                    .append("g")
                    .attr("transform", `translate(${radius},${radius})`);
      const arc = d3.arc()
                    .startAngle(d => d.x0)
                    .endAngle(d => d.x1)
                    .innerRadius(d => d.y0)
                    .outerRadius(d => d.y1);
      svg.selectAll("path")
         .data(root.descendants())
         .enter().append("path")
         .attr("display", d => d.depth ? null : "none")
         .attr("d", arc)
         .style("stroke", "#fff")
         .style("fill", d => {
           if (d.depth === 1) return "#0d6efd";
           if (d.depth === 2) return "#ffc107";
           return "#dc3545";
         })
         .append("title")
         .text(d => d.data.name);
      document.getElementById("sunburstInterpretation").innerHTML = "<p>The sunburst chart provides a hierarchical view of your AVAV traits, highlighting areas for improvement.</p>";
    }

    // ----------------- Interpretations & Insights ----------------- //
    function getParameterScores() {
      const scoresByCategory = {
        "Aahara (Diet & Nutrition)": [],
        "Vihara (Lifestyle & Daily Routine)": [],
        "Achara (Conduct, Behavior, and Ethics)": [],
        "Vichara (Thought Process & Mental Discipline)": [],
      };
      parameters.forEach((param, index) => {
        const radios = document.getElementsByName("param" + index);
        let score = 0;
        radios.forEach(radio => {
          if (radio.checked) score = parseInt(radio.value);
        });
        scoresByCategory[param.category].push({ name: param.name, score: score });
      });
      return scoresByCategory;
    }

    function generateCategoryInterpretation(category, scores, average) {
      const lowParams = scores.filter(p => p.score < 5).map(p => p.name);
      const midParams = scores.filter(p => p.score >= 5 && p.score < 7.5).map(p => p.name);
      const highParams = scores.filter(p => p.score >= 7.5).map(p => p.name);
      let text = `<h4>${category} Analysis</h4>`;
      text += `<p><strong>Average Score:</strong> ${average.toFixed(2)} (${classify(average)})</p>`;
      if (lowParams.length) text += `<p><strong>Needs Improvement:</strong> ${lowParams.join(", ")}</p>`;
      if (midParams.length) text += `<p><strong>Moderate Areas:</strong> ${midParams.join(", ")}</p>`;
      if (highParams.length) text += `<p><strong>Strengths:</strong> ${highParams.join(", ")}</p>`;
      text += `<p>Focus on the low scoring aspects to enhance overall balance.</p>`;
      return text;
    }

    function generateChartInterpretations(categoryAverages, trendData, scatterData) {
      const scoresByCategory = getParameterScores();
      let barInterp = `<h3>Bar Chart Analysis</h3>`;
      Object.keys(categoryAverages).forEach(cat => {
        barInterp += generateCategoryInterpretation(cat, scoresByCategory[cat], categoryAverages[cat]);
      });
      document.getElementById("barChartInterpretation").innerHTML = barInterp;

      const radarInterp = `<h3>Radar Chart Analysis</h3>
                           <p>The radar chart mirrors the bar chart data. Notice any significant imbalances between categories and target low-scoring areas.</p>`;
      document.getElementById("radarChartInterpretation").innerHTML = radarInterp;

      const pieInterp = `<h3>Pie Chart Analysis</h3>
                         <p>This chart shows the proportional contribution of each category to your overall score.</p>`;
      document.getElementById("pieChartInterpretation").innerHTML = pieInterp;

      const donutInterp = `<h3>Donut Chart Analysis</h3>
                           <p>The donut chart displays the distribution of classifications (Sattva, Rajas, Tamas) across categories.</p>`;
      document.getElementById("donutChartInterpretation").innerHTML = donutInterp;

      const lineInterp = `<h3>Line Chart Analysis</h3>
                          <p>Your overall score trend over time is depicted in the line chart. Monitor changes to adjust your practice.</p>`;
      document.getElementById("lineChartInterpretation").innerHTML = lineInterp;

      const scatterInterp = `<h3>Scatter Plot Analysis</h3>
                             <p>The scatter plot displays individual parameter scores. Clusters of low scores indicate focus areas.</p>`;
      document.getElementById("scatterChartInterpretation").innerHTML = scatterInterp;
    }

    function generatePersonalizedInsights() {
      const parameterScores = [];
      parameters.forEach((param, index) => {
        const radios = document.getElementsByName("param" + index);
        let score = 0;
        radios.forEach(radio => {
          if (radio.checked) score = parseInt(radio.value);
        });
        if (score > 0)
          parameterScores.push({ name: param.name, score: score, category: param.category });
      });
      const top3 = [...parameterScores].sort((a, b) => b.score - a.score).slice(0, 3);
      const bottom3 = [...parameterScores].sort((a, b) => a.score - b.score).slice(0, 3);
      const actionPlan = "Focus on the low scoring parameters. Consider adopting mindful practices, seeking expert guidance, and tracking your progress consistently.";
      const html = `<h2>Insights & Personalized Recommendations</h2>
        <div class="insights">
          <h3>Strengths</h3>
          <p><strong>Top 3 Strongest Traits:</strong> ${top3.map(p => `${p.name} (${p.score})`).join(", ")}</p>
          <h3>Areas for Improvement</h3>
          <p><strong>Bottom 3 Weakest Parameters:</strong> ${bottom3.map(p => `${p.name} (${p.score})`).join(", ")}</p>
          <p><strong>Recommended Action Plan:</strong> ${actionPlan}</p>
        </div>`;
      document.getElementById("personalizedInsights").innerHTML = html;
    }

    // ----------------- Data Export & Persistence ----------------- //
    function downloadCSV() {
      let csvContent = "data:text/csv;charset=utf-8,Category,Parameter,Score,Weight,Remarks\n";
      parameters.forEach((param, index) => {
        const radios = document.getElementsByName("param" + index);
        let score = "";
        radios.forEach(radio => {
          if (radio.checked) score = radio.value;
        });
        const remark = document.getElementsByName("remark" + index)[0].value;
        csvContent += `"${param.category}","${param.name}","${score}","${param.weight}","${remark}"\n`;
      });
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "AVAV_Yogic_Traits_Report.csv");
      document.body.appendChild(link);
      link.click();
    }

    function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(16);
      doc.text("AVAV Yogic Traits Report", 10, 20);
      doc.setFontSize(12);
      const resultText = document.getElementById("result").innerText;
      const insightsText = document.getElementById("insights").innerText;
      doc.text(resultText, 10, 30);
      doc.text(insightsText, 10, 50);
      doc.save("AVAV_Yogic_Traits_Report.pdf");
    }

    function downloadGuideJSON() {
      const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(guideData, null, 2));
      const downloadAnchorNode = document.createElement('a');
      downloadAnchorNode.setAttribute("href", dataStr);
      downloadAnchorNode.setAttribute("download", "criteria_guide.json");
      document.body.appendChild(downloadAnchorNode);
      downloadAnchorNode.click();
      downloadAnchorNode.remove();
    }

    function saveData() {
      const data = [];
      parameters.forEach((param, index) => {
        const radios = document.getElementsByName("param" + index);
        let selectedScore = "";
        radios.forEach(radio => {
          if (radio.checked) selectedScore = radio.value;
        });
        const remark = document.getElementsByName("remark" + index)[0].value;
        data.push({ score: selectedScore, remark: remark });
      });
      localStorage.setItem("avavData", JSON.stringify(data));
      alert("Data saved successfully!");
    }

    function loadData() {
      const data = JSON.parse(localStorage.getItem("avavData"));
      if (!data) {
        alert("No saved data found.");
        return;
      }
      data.forEach((entry, index) => {
        const radios = document.getElementsByName("param" + index);
        radios.forEach(radio => {
          if (radio.value === entry.score) radio.checked = true;
        });
        document.getElementsByName("remark" + index)[0].value = entry.remark;
      });
      alert("Data loaded successfully!");
    }

    // ----------------- Guide Wizard / Help Modal Functions ----------------- //
    function showGuide(index) {
      wizardIndex = index;
      if (!guideData.length) {
        alert("Guide data not loaded yet. Please try again later.");
        return;
      }
      displayGuide(guideData[wizardIndex]);
      const guideModal = new bootstrap.Modal(document.getElementById("guideModal"));
      guideModal.show();
      updateModalButtons();
    }
    function startGuideWizard() {
      wizardIndex = 0;
      if (!guideData.length) {
        alert("Guide data not loaded yet. Please try again later.");
        return;
      }
      displayGuide(guideData[wizardIndex]);
      const guideModal = new bootstrap.Modal(document.getElementById("guideModal"));
      guideModal.show();
      updateModalButtons();
    }
    function displayGuide(guide) {
      document.getElementById("guideModalLabel").innerHTML = `${guide.Category} - ${guide.Parameter}`;
      document.getElementById("guideModalBody").innerHTML = `<p>${guide.Guide}</p>`;
    }
    function nextGuide() {
      if (wizardIndex < guideData.length - 1) {
        wizardIndex++;
        displayGuide(guideData[wizardIndex]);
        updateModalButtons();
      } else {
        const modalEl = document.getElementById("guideModal");
        const modal = bootstrap.Modal.getInstance(modalEl);
        modal.hide();
      }
    }
    function prevGuide() {
      if (wizardIndex > 0) {
        wizardIndex--;
        displayGuide(guideData[wizardIndex]);
        updateModalButtons();
      }
    }
    function updateModalButtons() {
      document.getElementById("prevBtn").disabled = (wizardIndex === 0);
      document.getElementById("nextBtn").innerText =
        (wizardIndex === guideData.length - 1) ? "Finish" : "Next";
    }
    function resetWizard() {
      wizardIndex = 0;
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
